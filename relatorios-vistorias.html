<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rios de Vistorias - Vistoria Cautelar SP</title>
    <link rel="stylesheet" href="assets/css/relatorios-vistorias.css">

</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="breadcrumb">
                <a href="dashboard.html">Dashboard</a>
                <span>></span>
                <span>Relat√≥rios de Vistorias</span>
            </div>
            
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="toggleTheme()">
                    <span id="theme-icon">üåô</span>
                </button>
                
                <a href="dashboard.html" class="btn btn-secondary">
                    <span>üè†</span>
                    Dashboard
                </a>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="page-header">
            <h1 class="page-title">Relat√≥rios de Vistorias</h1>
            <p class="page-subtitle">Acesse relat√≥rios de vistorias no sistema</p>
        </div>

        <div id="alertContainer"></div>

        <div class="controls-section">
            <div class="controls-grid">
                <div class="filter-section">
                    <input type="date" class="form-input" id="startDate" placeholder="Data Inicial">
                    <input type="date" class="form-input" id="endDate" placeholder="Data Final">
                    <select class="filter-select" id="statusFilter">
                        <option value="">Todos os Status</option>
                        <option value="pendente">Pendente</option>
                        <option value="andamento">Em Andamento</option>
                        <option value="concluida">Conclu√≠da</option>
                        <option value="cancelada">Cancelada</option>
                    </select>
                </div>
                <button class="btn btn-secondary" onclick="exportReports()">
                    <span>üìä</span>
                    Exportar Relat√≥rio
                </button>
            </div>
        </div>

        <div class="reports-grid" id="reportsGrid">
            <!-- Relat√≥rios carregados dinamicamente -->
        </div>
    </main>

    <script>
        // Sample reports data for vistorias
        const sampleReports = [
            { title: 'Vistorias Pendentes', value: '28', description: 'Aguardando a√ß√£o' },
            { title: 'Vistorias em Andamento', value: '45', description: 'Em progresso' },
            { title: 'Vistorias Conclu√≠das', value: '320', description: 'Finalizadas' },
            { title: 'Taxa de Atraso', value: '5%', description: 'Vistorias atrasadas' }
        ];

        // Theme Management
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            const icon = document.getElementById('theme-icon');
            icon.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        // Session Management
        function checkSession() {
            const session = localStorage.getItem('userSession');
            if (!session) {
                window.location.href = 'login.html';
                return false;
            }
            const profile = JSON.parse(session).profile;
            if (profile !== 'admin' && profile !== 'gestor') {
                document.getElementById('alertContainer').innerHTML = `
                    <div class="alert alert-error">
                        Acesso restrito. Apenas admins e gestores podem acessar esta se√ß√£o.
                    </div>
                `;
                document.getElementById('reportsGrid').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üîí</div>
                        <p>Acesso n√£o autorizado.</p>
                    </div>
                `;
                return false;
            }
            return true;
        }

        // Populate Reports
        function populateReports() {
            const reportsGrid = document.getElementById('reportsGrid');
            reportsGrid.innerHTML = '';
            sampleReports.forEach(report => {
                const reportCard = document.createElement('div');
                reportCard.className = 'report-card';
                reportCard.innerHTML = `
                    <h3 class="report-title">${report.title}</h3>
                    <div class="report-value">${report.value}</div>
                    <p class="stat-description">${report.description}</p>
                `;
                reportsGrid.appendChild(reportCard);
            });
        }

        // Export Reports
        function exportReports() {
            const csv = ['T√≠tulo,Valor,Descri√ß√£o'];
            sampleReports.forEach(r => csv.push(`${r.title},${r.value},${r.description}`));
            const blob = new Blob([csv.join('\n')], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'relatorios-vistorias.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            if (checkSession()) {
                populateReports();
                // Adicionar l√≥gica para filtros de data e status
                document.getElementById('startDate').addEventListener('change', populateReports);
                document.getElementById('endDate').addEventListener('change', populateReports);
                document.getElementById('statusFilter').addEventListener('change', populateReports);
            }
        });
    </script>
</body>
</html>